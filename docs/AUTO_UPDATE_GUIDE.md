# è‡ªåŠ¨æ›´æ–°ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

PC Utility Tool å·²é›†æˆ **electron-updater** å®ç°åº”ç”¨çš„è‡ªåŠ¨æ›´æ–°åŠŸèƒ½ã€‚ç”¨æˆ·æ— éœ€æ‰‹åŠ¨ä¸‹è½½æ–°ç‰ˆæœ¬ï¼Œåº”ç”¨ä¼šè‡ªåŠ¨æ£€æµ‹ã€ä¸‹è½½å¹¶å®‰è£…æ›´æ–°ã€‚

---

## åŠŸèƒ½ç‰¹æ€§

âœ… **è‡ªåŠ¨æ£€æŸ¥æ›´æ–°** - åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥ï¼Œå¹¶æ¯ 6 å°æ—¶å®šæ—¶æ£€æŸ¥  
âœ… **ä¸‹è½½è¿›åº¦æ˜¾ç¤º** - å®æ—¶æ˜¾ç¤ºä¸‹è½½è¿›åº¦å’Œé€Ÿåº¦  
âœ… **ç”¨æˆ·å¯æ§** - ç”¨æˆ·å¯é€‰æ‹©ç«‹å³æ›´æ–°æˆ–ç¨åæ›´æ–°  
âœ… **æ— ç¼æ›´æ–°** - ä¸‹è½½å®Œæˆåä¸€é”®é‡å¯å®‰è£…  
âœ… **GitHub Releases** - é€šè¿‡ GitHub Releases åˆ†å‘æ›´æ–°  

---

## ä½¿ç”¨æ–¹å¼

### 1. åœ¨ Settings é¡µé¢æ£€æŸ¥æ›´æ–°

1. æ‰“å¼€åº”ç”¨ï¼Œè¿›å…¥ **Settings** é¡µé¢
2. æ‰¾åˆ° **åº”ç”¨æ›´æ–°** å¡ç‰‡
3. ç‚¹å‡» **æ£€æŸ¥æ›´æ–°** æŒ‰é’®

### 2. è‡ªåŠ¨åå°æ£€æŸ¥

åº”ç”¨æ¯ 6 å°æ—¶ä¼šè‡ªåŠ¨åœ¨åå°æ£€æŸ¥æ›´æ–°ï¼Œå‘ç°æ–°ç‰ˆæœ¬æ—¶ä¼šï¼š
- æ˜¾ç¤ºé€šçŸ¥æç¤ºæœ‰æ–°ç‰ˆæœ¬å¯ç”¨
- åœ¨æ›´æ–°å¡ç‰‡ä¸­æ˜¾ç¤ºæ›´æ–°è¯¦æƒ…
- ç­‰å¾…ç”¨æˆ·ç¡®è®¤ä¸‹è½½

### 3. ä¸‹è½½å’Œå®‰è£…æ›´æ–°

**å‘ç°æ–°ç‰ˆæœ¬å**ï¼š
1. ç‚¹å‡» **ä¸‹è½½æ›´æ–°** æŒ‰é’®
2. ç­‰å¾…ä¸‹è½½å®Œæˆï¼ˆæ˜¾ç¤ºå®æ—¶è¿›åº¦ï¼‰
3. ä¸‹è½½å®Œæˆåç‚¹å‡» **ç«‹å³é‡å¯æ›´æ–°**
4. åº”ç”¨ä¼šè‡ªåŠ¨é‡å¯å¹¶å®Œæˆæ›´æ–°å®‰è£…

**ç¨åæ›´æ–°**ï¼š
- å¦‚æœæš‚æ—¶ä¸æƒ³æ›´æ–°ï¼Œå¯ä»¥å…³é—­æç¤º
- åº”ç”¨ä¼šåœ¨é€€å‡ºæ—¶è‡ªåŠ¨å®‰è£…å·²ä¸‹è½½çš„æ›´æ–°

---

## å‘å¸ƒæ–°ç‰ˆæœ¬ï¼ˆå¼€å‘è€…ï¼‰

> ğŸ’¡ **æ¨èä½¿ç”¨è‡ªåŠ¨åŒ–å‘å¸ƒæµç¨‹**ï¼Œè¯¦è§ [RELEASE_WORKFLOW.md](./RELEASE_WORKFLOW.md)

### å¿«é€Ÿå‘å¸ƒï¼ˆæ¨èï¼‰

```bash
# æ–¹å¼ 1: ä½¿ç”¨å½“å‰ç‰ˆæœ¬å‘å¸ƒ
npm run release

# æ–¹å¼ 2: å‘å¸ƒæ–°ç‰ˆæœ¬
npm run release:version 1.1.0
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- æ›´æ–°ç‰ˆæœ¬å·ï¼ˆå¦‚æœæŒ‡å®šï¼‰
- åˆ›å»º git tag
- æ¨é€åˆ° GitHub
- è§¦å‘ GitHub Actions è‡ªåŠ¨æ„å»ºå’Œå‘å¸ƒ

**GitHub Actions ä¼šè‡ªåŠ¨å®Œæˆ**ï¼š
- æ„å»º Windows/Mac/Linux ç‰ˆæœ¬
- åˆ›å»º GitHub Release
- ä¸Šä¼ æ‰€æœ‰å®‰è£…åŒ…

### æ‰‹åŠ¨å‘å¸ƒï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰

<details>
<summary>å±•å¼€æŸ¥çœ‹æ‰‹åŠ¨å‘å¸ƒæ­¥éª¤ï¼ˆä¸æ¨èï¼‰</summary>

#### 1. æ›´æ–°ç‰ˆæœ¬å·

ç¼–è¾‘ `package.json`ï¼š
```json
{
  "version": "1.1.0"
}
```

#### 2. æ„å»ºåº”ç”¨

```bash
npm run electron:build
```

è¿™ä¼šåœ¨ `release` ç›®å½•ç”Ÿæˆï¼š
- Windows: `PC Utility Tool Setup 1.1.0.exe` (NSIS å®‰è£…åŒ…)
- Windows: `PC Utility Tool 1.1.0.exe` (ä¾¿æºç‰ˆ)
- Mac: `PC Utility Tool-1.1.0.dmg`
- Linux: `PC Utility Tool-1.1.0.AppImage`

#### 3. åˆ›å»º GitHub Release

1. å‰å¾€ GitHub ä»“åº“çš„ Releases é¡µé¢
2. ç‚¹å‡» **Draft a new release**
3. åˆ›å»ºæ–° tagï¼ˆä¾‹å¦‚ `v1.1.0`ï¼‰
4. å¡«å†™ Release notesï¼ˆæ›´æ–°è¯´æ˜ï¼‰
5. ä¸Šä¼  `release` ç›®å½•ä¸­çš„æ‰€æœ‰å®‰è£…åŒ…
6. å‘å¸ƒ Release

**é‡è¦**ï¼š
- Tag å¿…é¡»ä»¥ `v` å¼€å¤´ï¼Œä¾‹å¦‚ `v1.1.0`
- å¿…é¡»ä¸Šä¼ æ‰€æœ‰å¹³å°çš„å®‰è£…åŒ…
- `latest.yml` (Windows) / `latest-mac.yml` (Mac) æ–‡ä»¶ä¼šè‡ªåŠ¨ç”Ÿæˆ

</details>

### å‘å¸ƒå

æ‰€æœ‰ç”¨æˆ·çš„åº”ç”¨ä¼šï¼š
1. è‡ªåŠ¨æ£€æµ‹åˆ°æ–°ç‰ˆæœ¬ï¼ˆ6å°æ—¶å†…æˆ–æ‰‹åŠ¨æ£€æŸ¥æ—¶ï¼‰
2. æç¤ºç”¨æˆ·ä¸‹è½½æ›´æ–°
3. ä¸‹è½½å¹¶å®‰è£…

---

## é…ç½®è¯´æ˜

### package.json é…ç½®

```json
{
  "build": {
    "publish": {
      "provider": "github",
      "owner": "papalqi",
      "repo": "pc-utility-tool-electron",
      "releaseType": "release"
    }
  }
}
```

**å‚æ•°è¯´æ˜**ï¼š
- `provider`: å‘å¸ƒæä¾›å•†ï¼ˆgithub / generic / s3ï¼‰
- `owner`: GitHub ç”¨æˆ·åæˆ–ç»„ç»‡å
- `repo`: ä»“åº“åç§°
- `releaseType`: å‘å¸ƒç±»å‹ï¼ˆ`release` æˆ– `prerelease`ï¼‰

### è‡ªåŠ¨æ›´æ–°æ£€æŸ¥é—´éš”

åœ¨ `electron/main/index.ts` ä¸­ä¿®æ”¹ï¼š

```typescript
// å¯åŠ¨è‡ªåŠ¨æ›´æ–°æ£€æŸ¥ï¼ˆé»˜è®¤ 6 å°æ—¶ï¼‰
appUpdater.startAutoUpdateCheck(6)

// ä¿®æ”¹ä¸º 12 å°æ—¶
appUpdater.startAutoUpdateCheck(12)
```

---

## æµ‹è¯•æ›´æ–°åŠŸèƒ½

### å¼€å‘ç¯å¢ƒæµ‹è¯•

1. **æ¨¡æ‹Ÿæ–°ç‰ˆæœ¬**ï¼š
   ```bash
   # ä¿®æ”¹ package.json ç‰ˆæœ¬å·ä¸ºæ›´é«˜ç‰ˆæœ¬
   "version": "1.0.1"
   
   # æ„å»º
   npm run electron:build
   
   # åˆ›å»º GitHub Release
   ```

2. **æµ‹è¯•æµç¨‹**ï¼š
   - ä½¿ç”¨æ—§ç‰ˆæœ¬åº”ç”¨
   - ç‚¹å‡»"æ£€æŸ¥æ›´æ–°"
   - éªŒè¯æ˜¯å¦èƒ½æ£€æµ‹åˆ°æ–°ç‰ˆæœ¬
   - æµ‹è¯•ä¸‹è½½å’Œå®‰è£…æµç¨‹

### ç”Ÿäº§ç¯å¢ƒéªŒè¯

1. å‘å¸ƒ beta ç‰ˆæœ¬ï¼ˆä½¿ç”¨ `prerelease`ï¼‰
2. åœ¨æµ‹è¯•æœºå™¨ä¸Šå®‰è£…
3. éªŒè¯è‡ªåŠ¨æ›´æ–°æµç¨‹
4. ç¡®è®¤æ— è¯¯åå‘å¸ƒæ­£å¼ç‰ˆæœ¬

---

## æ•…éšœæ’æŸ¥

### æ— æ³•æ£€æµ‹åˆ°æ›´æ–°

**å¯èƒ½åŸå› **ï¼š
- GitHub Release æœªæ­£ç¡®åˆ›å»º
- Tag æ ¼å¼ä¸æ­£ç¡®ï¼ˆå¿…é¡»æ˜¯ `v1.0.0` æ ¼å¼ï¼‰
- ç½‘ç»œé—®é¢˜æ— æ³•è®¿é—® GitHub
- ç‰ˆæœ¬å·æ²¡æœ‰é€’å¢

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ GitHub Releases é¡µé¢
2. éªŒè¯ tag æ ¼å¼
3. æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼š`%APPDATA%/pc-utility-tool-electron/logs`

### ä¸‹è½½å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- ç½‘ç»œä¸ç¨³å®š
- GitHub é™æµ
- å®‰è£…åŒ…æ–‡ä»¶æŸå

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. é‡è¯•ä¸‹è½½
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. é‡æ–°ä¸Šä¼ å®‰è£…åŒ…åˆ° GitHub Release

### å®‰è£…å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- æƒé™ä¸è¶³
- é˜²ç—…æ¯’è½¯ä»¶æ‹¦æˆª
- ç£ç›˜ç©ºé—´ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œåº”ç”¨
2. ä¸´æ—¶ç¦ç”¨é˜²ç—…æ¯’è½¯ä»¶
3. æ¸…ç†ç£ç›˜ç©ºé—´

---

## é«˜çº§é…ç½®

### ä½¿ç”¨è‡ªå®šä¹‰æ›´æ–°æœåŠ¡å™¨

å¦‚æœä¸æƒ³ä½¿ç”¨ GitHub Releasesï¼Œå¯ä»¥é…ç½®è‡ªå®šä¹‰æœåŠ¡å™¨ï¼š

```json
{
  "build": {
    "publish": {
      "provider": "generic",
      "url": "https://your-server.com/updates"
    }
  }
}
```

æœåŠ¡å™¨éœ€è¦æä¾›ï¼š
- `latest.yml` - åŒ…å«æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯
- å®‰è£…åŒ…æ–‡ä»¶

### ç¦ç”¨è‡ªåŠ¨æ›´æ–°

åœ¨ `electron/main/updater.ts` ä¸­ï¼š

```typescript
// å®Œå…¨ç¦ç”¨
if (isDev || process.env.DISABLE_AUTO_UPDATE === 'true') {
  return
}
```

æˆ–åœ¨å¯åŠ¨æ—¶è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
set DISABLE_AUTO_UPDATE=true
npm run electron:dev
```

---

## æ›´æ–°æµç¨‹å›¾

```
ç”¨æˆ·å¯åŠ¨åº”ç”¨
    â†“
è‡ªåŠ¨æ£€æŸ¥æ›´æ–°ï¼ˆåå°ï¼‰
    â†“
å‘ç°æ–°ç‰ˆæœ¬ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ æ˜¾ç¤ºæ›´æ–°æç¤º
    â”‚         â†“
    â”‚     ç”¨æˆ·ç‚¹å‡»ä¸‹è½½
    â”‚         â†“
    â”‚     ä¸‹è½½å®‰è£…åŒ…ï¼ˆæ˜¾ç¤ºè¿›åº¦ï¼‰
    â”‚         â†“
    â”‚     ä¸‹è½½å®Œæˆ
    â”‚         â†“
    â”‚     ç”¨æˆ·ç‚¹å‡»é‡å¯
    â”‚         â†“
    â”‚     åº”ç”¨é‡å¯å¹¶å®‰è£…æ›´æ–°
    â”‚
    â””â”€ å¦ â†’ ç»§ç»­ä½¿ç”¨å½“å‰ç‰ˆæœ¬
```

---

## æ—¥å¿—å’Œè°ƒè¯•

### æŸ¥çœ‹æ›´æ–°æ—¥å¿—

**Windows**:
```
%APPDATA%\pc-utility-tool-electron\logs\main.log
```

**Mac**:
```
~/Library/Logs/pc-utility-tool-electron/main.log
```

**Linux**:
```
~/.config/pc-utility-tool-electron/logs/main.log
```

### è°ƒè¯•ä¿¡æ¯

åœ¨æ—¥å¿—ä¸­æœç´¢ `[Updater]` æ ‡è®°ï¼š
```
[Updater] æ­£åœ¨æ£€æŸ¥æ›´æ–°...
[Updater] å‘ç°æ–°ç‰ˆæœ¬: 1.1.0
[Updater] ä¸‹è½½è¿›åº¦: 45.32% (2.5 MB/s)
[Updater] æ›´æ–°ä¸‹è½½å®Œæˆ: 1.1.0
```

---

## æœ€ä½³å®è·µ

1. **ç‰ˆæœ¬å·è§„èŒƒ**ï¼šéµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆSemantic Versioningï¼‰
   - ä¸»ç‰ˆæœ¬å·ï¼šä¸å…¼å®¹çš„ API ä¿®æ”¹
   - æ¬¡ç‰ˆæœ¬å·ï¼šå‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢
   - ä¿®è®¢å·ï¼šå‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£

2. **å‘å¸ƒè¯´æ˜**ï¼šæ¯æ¬¡æ›´æ–°æä¾›æ¸…æ™°çš„ Release Notes
   - æ–°åŠŸèƒ½
   - Bug ä¿®å¤
   - å·²çŸ¥é—®é¢˜

3. **æµ‹è¯•**ï¼šæ¯ä¸ªç‰ˆæœ¬å‘å¸ƒå‰å……åˆ†æµ‹è¯•æ›´æ–°æµç¨‹

4. **å›æ»šè®¡åˆ’**ï¼šä¿ç•™æ—§ç‰ˆæœ¬å®‰è£…åŒ…ï¼Œä»¥ä¾¿å‡ºé—®é¢˜æ—¶å›æ»š

---

## ç›¸å…³æ–‡ä»¶

**æ›´æ–°åŠŸèƒ½**ï¼š
- `electron/main/updater.ts` - æ›´æ–°ç®¡ç†å™¨
- `electron/main/index.ts` - ä¸»è¿›ç¨‹é›†æˆ
- `electron/preload/index.ts` - Preload API
- `src/components/widgets/UpdateChecker.tsx` - æ›´æ–° UI ç»„ä»¶
- `src/global.d.ts` - TypeScript ç±»å‹å®šä¹‰

**å‘å¸ƒè‡ªåŠ¨åŒ–**ï¼š
- `.github/workflows/release.yml` - GitHub Actions å·¥ä½œæµ
- `scripts/release/publish-electron.ps1` - Windows å‘å¸ƒè„šæœ¬
- `scripts/release/publish-electron.sh` - Mac/Linux å‘å¸ƒè„šæœ¬
- `package.json` - æ„å»ºå’Œå‘å¸ƒé…ç½®

**æ–‡æ¡£**ï¼š
- `docs/AUTO_UPDATE_GUIDE.md` - è‡ªåŠ¨æ›´æ–°ä½¿ç”¨æŒ‡å—
- `docs/RELEASE_WORKFLOW.md` - å‘å¸ƒæµç¨‹è¯¦è§£

---

## å‚è€ƒèµ„æ–™

- [electron-updater æ–‡æ¡£](https://www.electron.build/auto-update)
- [electron-builder æ–‡æ¡£](https://www.electron.build/)
- [GitHub Releases æ–‡æ¡£](https://docs.github.com/en/repositories/releasing-projects-on-github)
